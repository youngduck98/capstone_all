{% extends 'layout.html' %}

{% block content %}

<table width="100%" height="60%">
    <!--button_area-->
    <tr>
      <td colspan=2>
        <table width="100%">
          <tr id="tabRow" height="1em">
            <td width = "10%">live_block_project</td>
            <td id = user_name>user_host</td>
            <td class="tabmax">
              <button id="trashButton" class="notext" title="...">
                <img src='../media/1x1.gif' class="trash icon21">
              </button>
              <button id="linkButton" class="notext" title="..." download>
                <img src='../media/1x1.gif' class="link icon21" herf = "">
              </button>
              <button id="runButton" class="notext primary" title="...">
                <img src='../media/1x1.gif' class="run icon21">
              </button>
              <button id="stopButton" onclick="lock_button()">lock</button>
              <button id="stopButton" onclick="unlock_button()">un_lock</button>
            </td>
          </tr>
        </table>
      </td>
    </tr>
    <!--content_area-->
    <tr>
      <td height="99%" width = "50%" id="content_area"></td>
      <td height="99%" width = "50%" id="content_area1"></td>            
    </tr>
</table>

<!--checkbox_table-->
<table width = "9%" height = "20%">
    <tr>
      <td id="user" class="taboff tab_collapse">host</td>
    </tr>
    <tr>
      <td id="other_user1" class="taboff tab_collapse" value="user_student1" onclick = student_tab_handler(this)>student1</td>
      <td id="check_user1"><input type="checkbox" name="check_right" value=1 onclick='getCheckboxValue(this)'></td>
    </tr>
    <tr>
      <td id="other_user2" class="taboff tab_collapse" value="user_student2" onclick = student_tab_handler(this)>student2</td>
      <td id="check_user2"><input type="checkbox" name="check_right" value=2 onclick='getCheckboxValue(this)'></td>
    </tr>
    <tr>
      <td id="other_user3" class="taboff tab_collapse" value="user_student3" onclick = student_tab_handler(this)>student3</td>
      <td id="check_user3"><input type="checkbox" name="check_right" value=3 onclick='getCheckboxValue(this)'></td>
    </tr>
</table>

<!--tool_box xml-->
<xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">
    <category name="%{BKY_CATLOGIC}" colour="%{BKY_LOGIC_HUE}">
      <block type="controls_if"></block>
      <block type="logic_compare"></block>
      <block type="logic_operation"></block>
      <block type="logic_negate"></block>
      <block type="logic_boolean"></block>
      <block type="logic_null"></block>
      <block type="logic_ternary"></block>
    </category>
    <category name="%{BKY_CATLOOPS}" colour="%{BKY_LOOPS_HUE}">
      <block type="controls_repeat_ext">
        <value name="TIMES">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
      </block>
      <block type="controls_whileUntil"></block>
      <block type="controls_for">
        <value name="FROM">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="TO">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
        <value name="BY">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
      <block type="controls_forEach"></block>
      <block type="controls_flow_statements"></block>
    </category>
    <category name="%{BKY_CATMATH}" colour="%{BKY_MATH_HUE}">
      <block type="math_number">
        <field name="NUM">123</field>
      </block>
      <block type="math_arithmetic">
        <value name="A">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="B">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
      <block type="math_single">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">9</field>
          </shadow>
        </value>
      </block>
      <block type="math_trig">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">45</field>
          </shadow>
        </value>
      </block>
      <block type="math_constant"></block>
      <block type="math_number_property">
        <value name="NUMBER_TO_CHECK">
          <shadow type="math_number">
            <field name="NUM">0</field>
          </shadow>
        </value>
      </block>
      <block type="math_round">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">3.1</field>
          </shadow>
        </value>
      </block>
      <block type="math_on_list"></block>
      <block type="math_modulo">
        <value name="DIVIDEND">
          <shadow type="math_number">
            <field name="NUM">64</field>
          </shadow>
        </value>
        <value name="DIVISOR">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
      </block>
      <block type="math_constrain">
        <value name="VALUE">
          <shadow type="math_number">
            <field name="NUM">50</field>
          </shadow>
        </value>
        <value name="LOW">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="HIGH">
          <shadow type="math_number">
            <field name="NUM">100</field>
          </shadow>
        </value>
      </block>
      <block type="math_random_int">
        <value name="FROM">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="TO">
          <shadow type="math_number">
            <field name="NUM">100</field>
          </shadow>
        </value>
      </block>
      <block type="math_random_float"></block>
      <block type="math_atan2">
        <value name="X">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="Y">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
    </category>
    <category name="%{BKY_CATTEXT}" colour="%{BKY_TEXTS_HUE}">
      <block type="text"></block>
      <block type="text_join"></block>
      <block type="text_append">
        <value name="TEXT">
          <shadow type="text"></shadow>
        </value>
      </block>
      <block type="text_length">
        <value name="VALUE">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_isEmpty">
        <value name="VALUE">
          <shadow type="text">
            <field name="TEXT"></field>
          </shadow>
        </value>
      </block>
      <block type="text_indexOf">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">{textVariable}</field>
          </block>
        </value>
        <value name="FIND">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_charAt">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">{textVariable}</field>
          </block>
        </value>
      </block>
      <block type="text_getSubstring">
        <value name="STRING">
          <block type="variables_get">
            <field name="VAR">{textVariable}</field>
          </block>
        </value>
      </block>
      <block type="text_changeCase">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_trim">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_print">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_prompt_ext">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
    </category>
    <category name="%{BKY_CATLISTS}" colour="%{BKY_LISTS_HUE}">
      <block type="lists_create_with">
        <mutation items="0"></mutation>
      </block>
      <block type="lists_create_with"></block>
      <block type="lists_repeat">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">5</field>
          </shadow>
        </value>
      </block>
      <block type="lists_length"></block>
      <block type="lists_isEmpty"></block>
      <block type="lists_indexOf">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">{listVariable}</field>
          </block>
        </value>
      </block>
      <block type="lists_getIndex">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">{listVariable}</field>
          </block>
        </value>
      </block>
      <block type="lists_setIndex">
        <value name="LIST">
          <block type="variables_get">
            <field name="VAR">{listVariable}</field>
          </block>
        </value>
      </block>
      <block type="lists_getSublist">
        <value name="LIST">
          <block type="variables_get">
            <field name="VAR">{listVariable}</field>
          </block>
        </value>
      </block>
      <block type="lists_split">
        <value name="DELIM">
          <shadow type="text">
            <field name="TEXT">,</field>
          </shadow>
        </value>
      </block>
      <block type="lists_sort"></block>
    </category>
    <category name="%{BKY_CATCOLOUR}" colour="%{BKY_COLOUR_HUE}">
      <block type="colour_picker"></block>
      <block type="colour_random"></block>
      <block type="colour_rgb">
        <value name="RED">
          <shadow type="math_number">
            <field name="NUM">100</field>
          </shadow>
        </value>
        <value name="GREEN">
          <shadow type="math_number">
            <field name="NUM">50</field>
          </shadow>
        </value>
        <value name="BLUE">
          <shadow type="math_number">
            <field name="NUM">0</field>
          </shadow>
        </value>
      </block>
      <block type="colour_blend">
        <value name="COLOUR1">
          <shadow type="colour_picker">
            <field name="COLOUR">#ff0000</field>
          </shadow>
        </value>
        <value name="COLOUR2">
          <shadow type="colour_picker">
            <field name="COLOUR">#3333ff</field>
          </shadow>
        </value>
        <value name="RATIO">
          <shadow type="math_number">
            <field name="NUM">0.5</field>
          </shadow>
        </value>
      </block>
    </category>
    <sep></sep>
    <category name="%{BKY_CATVARIABLES}" colour="%{BKY_VARIABLES_HUE}" custom="VARIABLE"></category>
    <category name="%{BKY_CATFUNCTIONS}" colour="%{BKY_PROCEDURES_HUE}" custom="PROCEDURE"></category>
</xml>

<div id="container"></div>
<div id="fake_workspace" display = "none"></div>
<!--<script src="/code.js"></script>-->

<!--위: 수정 중, 아래: 원본 back 코드-->

<div id="another-workspace"></div>

<div id="my-workspace">
    <!-- 임시 이벤트 -->
    <form action="/changeSnapshot" id="change-snapshot" method="post">
        임시 이벤트 -->
        <input type="text" id="tEvent" name="tEvent">
        <button type="submit">선택</button>
    </form>
</div>
<div id="workspace-group-list">
    {% for workspace in workSpaceGroups %}
    <div class="workspace-group">
        <div class="workspace-group-info">hostWorkSpaceId : {{ workspace.hostWorkSpaceId }}</div>
        <div class="workspace-group-info">subWorkSpaceId : {{ workspace.subWorkSpaceId }}</div>
        <div class="workspace-group-info">hostUserId : {{ workspace.hostUserId }}</div>
        <div class="workspace-group-info">subUserId : {{ workspace.subUserId }}</div>
<!--        <form action="/change" id="workspace-change-form" method="post">-->
<!--            <input type="hidden" id="sub-workspace" name="subWorkspace" value="{{ workspace.subUserId }}">-->
<!--            <button type="submit">선택</button>-->
<!--        </form>-->
    </div>
    {% endfor %}
</div>

<a href="/" id="exit-btn">방 나가기</a>
<!--
<fieldset>
    <div id="chat-list">
        {% for chat in chats %}
        {% if chat.userId === 'system' %}
        <div class="system">
            <div>#system</div>
            <div>{{chat.chat}}</div>
        </div>
        {% else %}
        <div class="user">
            <div>{{chat.nick}}</div>
            <div>{{chat.chat}}</div>
        </div>
        {% endif %}
        {% endfor %}
    </div>
</fieldset>

<form action="/chat" id="chat-form" method="post">
    <input type="text" id="chat" name="chat">
    <button type="submit">전송</button>
</form>
-->

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://unpkg.com/event-source-polyfill/src/eventsource.min.js"></script>
<script src="/socket.io/socket.io.js"></script>

<script>
    const socket = io.connect('http://localhost:8002',{
        path: '/socket.io',
    });
    // 방입장
    socket.on('join_ex', function (data) {
        // 채팅 추가
        const div = document.createElement('div');
        div.classList.add('system');
        const chat = document.createElement('div');
        div.textContent = data.chat;
        div.appendChild(chat);
        document.querySelector('#chat-list').appendChild(div);

    });
    socket.on('join_new', function (data) {
        // 채팅 추가
        const div = document.createElement('div');
        div.classList.add('system');
        const chat = document.createElement('div');
        div.textContent = data.chat;
        div.appendChild(chat);
        document.querySelector('#chat-list').appendChild(div);

        // 멤버 리스트 추가
        const workspace = document.createElement('div');
        workspace.classList.add('workspace-group');
        const hostWorkSpaceId = document.createElement('div');
        hostWorkSpaceId.classList.add('workspace-group-info');
        hostWorkSpaceId.textContent = 'hostWorkSpaceId : ' + data.workspace.hostWorkSpaceId;
        const subWorkSpaceId = document.createElement('div');
        subWorkSpaceId.classList.add('workspace-group-info');
        subWorkSpaceId.textContent = 'subWorkSpaceId : ' + data.workspace.subWorkSpaceId;
        const hostUserId = document.createElement('div');
        hostUserId.classList.add('workspace-group-info');
        hostUserId.textContent = 'hostUserId : ' + data.workspace.hostUserId;
        const subUserId = document.createElement('div');
        subUserId.classList.add('workspace-group-info');
        subUserId.textContent = 'subUserId : ' + data.workspace.subUserId;
        workspace.appendChild(hostWorkSpaceId);
        workspace.appendChild(subWorkSpaceId);
        workspace.appendChild(hostUserId);
        workspace.appendChild(subUserId);
        document.querySelector('#workspace-group-list').appendChild(workspace);

    });
    // 방퇴장
    socket.on('exit', function (data) {
        const div = document.createElement('div');
        div.classList.add('system');
        const chat = document.createElement('div');
        div.textContent = data.chat;
        div.appendChild(chat);
        document.querySelector('#chat-list').appendChild(div);
    });
    // 채팅입력시 생성
    socket.on('chat', function (data) {
        const div = document.createElement('div');
        div.classList.add('user');
        const name = document.createElement('div');
        name.textContent = data.nick;
        div.appendChild(name);
        const chat = document.createElement('div');
        chat.textContent = data.chat;
        div.appendChild(chat);
        document.querySelector('#chat-list').appendChild(div);
    });
    // 임시 이벤트 소켓, data에 workspace가 들어있음
    socket.on('changeSnapshot', function(data){
        const div = document.createElement('div');
        div.textContent = data.snapshot;
        document.querySelector('#my-workspace').appendChild(div);
    })

    document.querySelector('#chat-form').addEventListener('submit', function (e) {
        e.preventDefault();
        if (e.target.chat.value) {
            axios.post('/workspace/{{workSpaceGroups[0].hostWorkSpaceId}}/chat', {
                chat: this.chat.value,
            })
                .then(() => {
                    e.target.chat.value = '';
                })
                .catch((err) => {
                    console.error(err);
                });
        }
    });

    // 임시 이벤트 리스너 여기 수정하면 됨
    document.querySelector('#change-snapshot').addEventListener('submit', function (e) {
        e.preventDefault();
        if (e.target.tEvent.value) {
            axios.post('/workspace/{{workSpaceGroups[0].hostWorkSpaceId}}/change/snapshot', {
                snapshot: this.tEvent.value,
            })
                .then(() => {
                    e.target.tEvent.value = '';
                })
                .catch((err) => {
                    console.error(err);
                });
        }
    });
</script>

<script>
  var MSG = {
    title: "코드",
    blocks: "블록",
    linkTooltip: "블록을 저장하고 링크를 가져옵니다.",
    runTooltip: "작업 공간에서 블록으로 정의된 프로그램을 실행합니다.",
    badCode: "프로그램 오류:\n%1",
    timeout: "최대 실행 반복을 초과했습니다.",
    trashTooltip: "모든 블록을 버립니다.",
    catLogic: "논리",
    catLoops: "반복",
    catMath: "수학",
    catText: "텍스트",
    catLists: "목록",
    catColour: "색",
    catVariables: "변수",
    catFunctions: "기능",
    listVariable: "목록",
    textVariable: "텍스트",
    httpRequestError: "요청에 문제가 있습니다.",
    linkAlert: "다음 링크로 블록을 공유하세요:\n\n%1",
    hashError: "죄송하지만 '%1'은 어떤 저장된 프로그램으로 일치하지 않습니다.",
    loadError: "저장된 파일을 불러올 수 없습니다. 혹시 블록리의 다른 버전으로 만들었습니까?",
    parseError: "%1 구문 분석 오류:\n%2\n\n바뀜을 포기하려면 '확인'을 선택하고 %1을 더 편집하려면 '취소'를 선택하세요."
};
</script>

<script>
  //category
  for (var messageKey in MSG) {
    if (messageKey.indexOf('cat') === 0) {
      Blockly.Msg[messageKey.toUpperCase()] = MSG[messageKey];
    }
  }
  
  //get toolbox from html
  var toolboxText = document.getElementById('toolbox').outerHTML;
  toolboxText = toolboxText.replace(/(^|[^%]){(\w+)}/g, function(m, p1, p2) {return p1 + MSG[p2];});
  var toolboxXml = Blockly.Xml.textToDom(toolboxText);
  
  //get user_name
  var user_name = document.getElementById('user_name').innerText;
  var user_list = ["user_host", "user_student1", "user_student2", "user_student3"];
  var other_user = [];
  
  //add eventlistener at DOMContentLoaded
  var my_workspace;
  var other_workspace;
  var workspace_xml = {};

  socket.on('changeSnapshot', function(data){
    var sn = data.id;
    console.log(sn);
    var xml = Blockly.Xml.textToDom(data.snapshot);
    console.log(xml);
    //내 workspace가 변했을 때
    if(sn == 3){
      my_workspace.clear();
      Blockly.Events.disable();
      Blockly.Xml.domToWorkspace(xml, my_workspace);
      Blockly.Events.enable();
    }
    //내가 보고있는 다른 workspace가 변했을 때
    if(sn == 3){
      other_workspace.clear();
      Blockly.Events.disable();
      Blockly.Xml.domToWorkspace(xml, other_workspace);
      Blockly.Events.enable();
    }
    else{
      workspace_xml[sn] = xml;
      console.log(sn);
    }
  });

  function getURLParams_last(url) {
    var url_arr = url.split("/");
    return url_arr[url_arr.length-1];
}

function getURLParams2_domain(url){
    var url_arr = url.split("/");
    console.log(url_arr[3] + url_arr[4]);
    return url_arr[4];
}
</script>

<script>
  document.addEventListener('DOMContentLoaded',async function(){
    //fill my container(left)
    //console.log(getURLParams(document.location.href));

    my_workspace = Blockly.inject('content_area',
    {
      toolbox: toolboxXml,
      media: '../media/',
    });

    //fill other container(right)
    other_workspace = Blockly.inject('content_area1',
    {
      toolbox: toolboxXml,
      media: '../media/',
    });

    //make xml of user
    for(var i=0;i<user_list.length;i++){
      workspace_xml[user_list[i]] = Blockly.Xml.workspaceToDom(Blockly.inject('fake_workspace',
      {
        toolbox: toolboxXml,
      }));
    }

    //fiil other_user
    var count = 0;
    for(var i=0;i<user_list.length;i++){
      if(user_list[i]!=user_name){
        count+=1;
        other_user.push(user_list[i]);
        console.log('other_user' + count);
        document.getElementById('other_user' + count).innerText = user_list[i];
      }
    }
    console.log(other_user);
    selected = other_user[0];

    //fill user_tab
    document.getElementById('user').innerText = user_name;
    for(var i=1;i<=other_user.length;i++){
      document.getElementById('other_user' + i).innerText = other_user[i-1];
    }

    //reserve words(for run's timeout)
    Blockly.JavaScript.addReservedWords('code,timeouts,checkTimeout');

    //insert block eventlistener
    //insert listener about my change
    my_workspace.addChangeListener((event) => {
      if (event.type === Blockly.Events.BLOCK_MOVE  ||event.type === Blockly.Events.BLOCK_CHANGE
        || event.type == Blockly.Events.BLOCK_CREATE || event.type == Blockly.Events.BLOCK_DELETE) {
        workspace_xml[user_name] = Blockly.Xml.workspaceToDom(my_workspace);
        console.log(workspace_xml[user_name]);
        window.localStorage.setItem(user_name, Blockly.Xml.domToText(workspace_xml[user_name]));
        window.localStorage.setItem("now", user_name);

        console.log(getURLParams2_domain(document.location.href)+'/change/snapshot');
        
        axios.post(getURLParams2_domain(document.location.href)+"/change/snapshot",{
          snapshot: Blockly.Xml.domToText(workspace_xml[user_name]),
        })
        .then(() => {
          console.log('성공');
        })
        .catch((error) => {
          console.error(error);
        });
      }
      if (event.isUiEvent) {
        return;
      }
    });
}, false);

async function workspace_copy(workspace1, workspace2){
  var xmlDom = Blockly.Xml.workspaceToDom(workspace1);
  workspace2.clear();
  Blockly.Xml.domToWorkspace(xmlDom, workspace2); 
}

//setting workspace to readonly
async function workspace_readonly(workspace){
  var xmlDom = Blockly.Xml.workspaceToDom(workspace);
  workspace.dispose();
  workspace = Blockly.inject('content_area1',
    {
      toolbox: toolboxXml,
      media: '../media/',
      readOnly: true,
    });
  Blockly.Xml.domToWorkspace(xmlDom, workspace);
}

var student = ["student1", "student2", "student3"];
  var selected = "other_user1";
  
  function student_tab_handler(clickedName) { 
    clickedName = clickedName.id;
    //before workspace 작업 처리
    if (document.getElementById("other_user1").classList.contains('tabon')) {
  
    }
    else if (document.getElementById("other_user2").classList.contains('tabon')) {
  
    }
    else if (document.getElementById("other_user3").classList.contains('tabon')) {
      
    }
  
    // Deselect all tabs and hide all panes.
    for (var i = 1; i <= other_user.length; i++) {
      var name = 'other_user' + i;
      var tab = document.getElementById(name);
      tab.classList.add('taboff');
      tab.classList.remove('tabon');
    }
  
    // Select the active tab.
    
    selected = document.getElementById(clickedName).innerText;
    var selectedTab = document.getElementById(clickedName);
    selectedTab.classList.remove('taboff');
    selectedTab.classList.add('tabon');
  
    //after workspace 작업 처리
    socket.on('changeSnapshot', function(data){
        var xml = Blockly.Xml.textToDom(data.snapshot);
        other_workspace.clear();
        Blockly.Events.disable();
        Blockly.Xml.domToWorkspace(xml, other_workspace);
        Blockly.Events.enable();
    });
  };
  
  /*only one checkbox*/
  var looking_work_box;
  var authoered_student;
  
  function getCheckboxValue(element)  {
    if(element.value == authoered_student){
      element.checked = false;
      authoered_student = 0;
    }
    else{
      // 선택된 목록 가져오기
      const checkboxes 
          = document.getElementsByName("check_right");
      
      // 선택된 목록에서 value 찾기
      checkboxes.forEach((el) => {
        el.checked = false;
      });
      
      authoered_student = element.value;
      element.checked = true;
      console.log(authoered_student)
    }
  }

  function  bindClick(el, func) {
    if (typeof el === 'string') {
      el = document.getElementById(el);
    }
    el.addEventListener('click', func, true);
  };

  function runJs(event) {
    Blockly.JavaScript.INFINITE_LOOP_TRAP = 'checkTimeout();\n';
    var timeouts = 0;
    var checkTimeout = function() {
      if (timeouts++ > 1000000) {
        throw MSG['timeout'];
      }
    };
  
    var code = Blockly.JavaScript.workspaceToCode(my_workspace);
    Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
    try {
      eval(code);
    } catch (e) {
      alert(MSG['badCode'].replace('%1', e));
    }
  };

  function discard() {
    console.log(document.location.href);
  };
  
  function download() {
    console.log(1);
    var download_txt = Blockly.Xml.domToText(Blockly.Xml.workspaceToDom(my_workspace));
    const blob = new Blob([download_txt], {type: 'text/plain'})
    print(blob);
    const downloadUrl = window.URL.createObjectURL(blob); // 해당 file을 가리키는 url 생성
   
    const anchorElement = document.createElement();
    if(anchorElement){
    anchorElement.href = downloadUrl; // href에 url 달아주기
   
    anchorElement.click(); // 코드 상으로 클릭을 해줘서 다운로드를 트리거
   
    document.body.removeChild(anchorElement); // cleanup - 쓰임을 다한 a 태그 삭제
    window.URL.revokeObjectUrl(downloadUrl); // cleanup - 쓰임을 다한 url 객체 삭제
    }
  }
  
  bindClick('trashButton',discard);
  bindClick('runButton', runJs);
  bindClick('linkButton', download);
</script>
{% endblock %}
